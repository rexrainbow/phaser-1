/**
  * @author       Richard Davey <rich@photonstorm.com>
  * @copyright    2020 Photon Storm Ltd.
  * @license      {@link https://opensource.org/licenses/MIT|MIT License}
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Phaser4={})}(this,(function(t){"use strict";function e(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}function n(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const n=()=>{document.removeEventListener("deviceready",n,!0),document.removeEventListener("DOMContentLoaded",n,!0),window.removeEventListener("load",n,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",n,!0):(document.addEventListener("DOMContentLoaded",n,!0),window.addEventListener("load",n,!0)):window.setTimeout(n,20)}var r=Object.freeze({__proto__:null,AddToDOM:function(t,n){return e(n).appendChild(t),t},DOMContentLoaded:n,GetElement:e,ParseXML:function(t){let e;try{return e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null}catch(t){return null}},RemoveFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)}});let i;function s(t,e){return e||(i||(i=document.createElement("audio")),e=i),e&&""!==e.canPlayType(t)}function o(t){return s("audio/x-m4a",t)||s("audio/aac",t)}function a(t){return s('audio/mpeg; codecs="mp3"',t)}function h(t){return s('audio/ogg; codecs="vorbis"',t)}function c(t){return s('audio/ogg; codecs="opus"',t)||s('audio/webm; codecs="opus"',t)}function u(t){return s('audio/wav; codecs="1"',t)}function l(t){return s('audio/webm; codecs="vorbis"',t)}function d(){return window&&window.hasOwnProperty("Audio")}function f(){return window&&(window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"))}function x(){const t={audioData:d(),m4a:!1,mp3:!1,ogg:!1,opus:!1,wav:!1,webAudio:f(),webm:!1};return t.audioData&&(t.m4a=o(),t.mp3=a(),t.ogg=h(),t.opus=c(),t.wav=u(),t.webm=l()),t}var p=Object.freeze({__proto__:null,CanPlayAudioType:s,CanPlayM4A:o,CanPlayMP3:a,CanPlayOGG:h,CanPlayOpus:c,CanPlayWAV:u,CanPlayWebM:l,GetAudio:x,HasAudio:d,HasWebAudio:f});function m(){const t=/Chrome\/(\d+)/.test(navigator.userAgent);return{chrome:t,chromeVersion:t?parseInt(RegExp.$1,10):0}}function g(){return{edge:/Edge\/\d+/.test(navigator.userAgent)}}function y(){const t=/Firefox\D+(\d+)/.test(navigator.userAgent);return{firefox:t,firefoxVersion:t?parseInt(RegExp.$1,10):0}}function T(){const t=/MSIE (\d+\.\d+);/.test(navigator.userAgent);return{ie:t,ieVersion:t?parseInt(RegExp.$1,10):0}}function w(){const t=navigator.userAgent,e={iOS:!1,iOSVersion:0,iPhone:!1,iPad:!1};if(/iP[ao]d|iPhone/i.test(t)){const n=/OS (\d+)/.exec(navigator.appVersion);e.iOS=!0,e.iOSVersion=parseInt(n[0],10),e.iPhone=t.toLowerCase().includes("iphone"),e.iPad=t.toLowerCase().includes("ipad")}return e}function S(){const{iOS:t}=w();return{mobileSafari:navigator.userAgent.includes("AppleWebKit")&&t}}function b(){return{opera:navigator.userAgent.includes("Opera")}}function v(){const t=navigator.userAgent;return/Windows Phone/i.test(t)||/IEMobile/i.test(t)}function E(){const t=navigator.userAgent;return{safari:t.includes("Safari")&&!v(),safariVersion:/Version\/(\d+)\./.test(t)?parseInt(RegExp.$1,10):0}}function A(){return{silk:navigator.userAgent.includes("Silk")}}function M(){const t=/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(navigator.userAgent);return{trident:t,tridentVersion:t?parseInt(RegExp.$1,10):0,tridentIEVersion:t?parseInt(RegExp.$3,10):0}}function _(){const{chrome:t,chromeVersion:e}=m(),{edge:n}=g(),{firefox:r,firefoxVersion:i}=y();let{ie:s,ieVersion:o}=T();const{mobileSafari:a}=S(),{opera:h}=b(),{safari:c,safariVersion:u}=E(),{silk:l}=A(),{trident:d,tridentVersion:f,tridentIEVersion:x}=M();return d&&(s=!0,o=x),{chrome:t,chromeVersion:e,edge:n,firefox:r,firefoxVersion:i,ie:s,ieVersion:o,mobileSafari:a,opera:h,safari:c,safariVersion:u,silk:l,trident:d,tridentVersion:f}}var R=Object.freeze({__proto__:null,GetBrowser:_,IsChrome:m,IsEdge:g,IsFirefox:y,IsMobileSafari:S,IsMSIE:T,IsOpera:b,IsSafari:E,IsSilk:A,IsTrident:M});function C(){return navigator.userAgent.includes("Android")}function I(){return navigator.userAgent.includes("CrOS")}function P(){return window.hasOwnProperty("cordova")}function F(){return navigator.userAgent.includes("Crosswalk")}function O(){return window.hasOwnProperty("ejecta")}function D(){const t=navigator.userAgent;return t.includes("Kindle")||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)}function z(){return navigator.userAgent.includes("Linux")}function B(){const t=navigator.userAgent;return t.includes("Mac OS")&&!t.includes("like Mac OS")}function k(){return"undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.hasOwnProperty("node")}function L(){return k()&&!!process.versions.hasOwnProperty("node-webkit")}function U(){return navigator.hasOwnProperty("standalone")}function G(){return navigator.userAgent.includes("Windows")}function X(){const t=navigator.userAgent,{iOS:e,iOSVersion:n,iPad:r,iPhone:i}=w(),s={android:C(),chromeOS:I(),cordova:P(),crosswalk:F(),desktop:!1,ejecta:O(),iOS:e,iOSVersion:n,iPad:r,iPhone:i,kindle:D(),linux:z(),macOS:B(),node:k(),nodeWebkit:L(),pixelRatio:1,webApp:U(),windows:G(),windowsPhone:v()};s.windowsPhone&&(s.android=!1,s.iOS=!1,s.macOS=!1,s.windows=!0);const o=t.includes("Silk");return(s.windows||s.macOS||s.linux&&!o||s.chromeOS)&&(s.desktop=!0),(s.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(s.desktop=!1),s}var V=Object.freeze({__proto__:null,GetOS:X,IsAndroid:C,IsChromeOS:I,IsCordova:P,IsCrosswalk:F,IsEjecta:O,IsiOS:w,IsKindle:D,IsLinux:z,IsMacOS:B,IsNode:k,IsNodeWebkit:L,IsWebApp:U,IsWindows:G,IsWindowsPhone:v});let N;function W(t,e){return e||(N||(N=document.createElement("video")),e=N),e&&""!==e.canPlayType(t)}function Y(t){return W('video/mp4; codecs="avc1.42E01E"',t)}function j(t){return W('application/x-mpegURL; codecs="avc1.42E01E"',t)}function H(t){return W('video/ogg; codecs="theora"',t)}function q(t){return W('video/webm; codecs="vp9"',t)}function $(t){return W('video/webm; codecs="vp8, vorbis"',t)}function K(){return{h264Video:Y(),hlsVideo:j(),oggVideo:H(),vp9Video:q(),webmVideo:$()}}var Z=Object.freeze({__proto__:null,CanPlayH264Video:Y,CanPlayHLSVideo:j,CanPlayOGGVideo:H,CanPlayVP9Video:q,CanPlayVideoType:W,CanPlayWebMVideo:$,GetVideo:K}),J=Object.freeze({__proto__:null,Audio:p,Browser:R,OS:V,Video:Z,CanPlayAudioType:s,CanPlayM4A:o,CanPlayMP3:a,CanPlayOGG:h,CanPlayOpus:c,CanPlayWAV:u,CanPlayWebM:l,GetAudio:x,HasAudio:d,HasWebAudio:f,GetBrowser:_,IsChrome:m,IsEdge:g,IsFirefox:y,IsMobileSafari:S,IsMSIE:T,IsOpera:b,IsSafari:E,IsSilk:A,IsTrident:M,GetOS:X,IsAndroid:C,IsChromeOS:I,IsCordova:P,IsCrosswalk:F,IsEjecta:O,IsiOS:w,IsKindle:D,IsLinux:z,IsMacOS:B,IsNode:k,IsNodeWebkit:L,IsWebApp:U,IsWindows:G,IsWindowsPhone:v,CanPlayH264Video:Y,CanPlayHLSVideo:j,CanPlayOGGVideo:H,CanPlayVP9Video:q,CanPlayVideoType:W,CanPlayWebMVideo:$,GetVideo:K});function Q(t,e,...n){if(!t.events.has(e))return!1;const r=t.events.get(e);for(const t of r)t.callback.apply(t.context,n),t.once&&r.delete(t);return 0===r.size&&t.events.delete(e),!0}class tt{constructor(){this.events=new Map}}class et{constructor(t,e,n=!1){this.callback=t,this.context=e,this.once=n}}function nt(t,e,n,r=t,i=!1){if("function"!=typeof n)throw new TypeError("Listener not a function");const s=new et(n,r,i),o=t.events.get(e);return o?o.add(s):t.events.set(e,new Set([s])),t}function rt(t,e,n,r=t){return nt(t,e,n,r,!0)}var it=Object.freeze({__proto__:null,ClearEvent:function(t,e){return t.events.delete(e),t},Emit:Q,EventEmitter:tt,EventInstance:et,GetEventNames:function(t){return[...t.events.keys()]},GetListenerCount:function(t,e){const n=t.events.get(e);return n?n.size:0},GetListeners:function(t,e){const n=[];return t.events.get(e).forEach(t=>{n.push(t.callback)}),n},Off:function(t,e,n,r,i){const s=t.events;if(n){const t=s.get(e),o=!r,a=void 0!==i;for(const e of t)e.callback===n&&o&&e.context===console&&a&&e.once===i&&t.delete(e);0===t.size&&s.delete(e)}else s.delete(e);return t},On:nt,Once:rt,RemoveAllListeners:function(t,e){e?t.events.delete(e):t.events.clear()}});function st(t,e){return t.children.indexOf(e)}function ot(t,e){const n=t.children,r=st(t,e);return r>-1&&(n.splice(r,1),e.parent=null),e}function at(t,...e){e.forEach(e=>{e.parent&&ot(e.parent,e),e.world=t.world,e.parent=t})}function ht(t,e){return e.set(t.a,t.b,t.c,t.d,t.tx,t.ty)}function ct(t){t.dirty.setRender();const e=t.parent,n=t.transform,r=n.local,i=n.world;if(r.tx=n.x,r.ty=n.y,!e)return void ht(r,i);const{a:s,b:o,c:a,d:h,tx:c,ty:u}=r,{a:l,b:d,c:f,d:x,tx:p,ty:m}=e.transform.world;i.set(s*l+o*f,s*d+o*x,a*l+h*f,a*d+h*x,c*l+u*f+p,c*d+u*x+m)}class ut{constructor(t=0,e=0,n=0,r=0){this.set(t,e,n,r)}set(t=0,e=0,n=0,r=0){return this.x=t,this.y=e,this.width=n,this.height=r,this}contains(t,e){return function(t,e,n){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=n&&t.y+t.height>=n)}(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}class lt{constructor(t){this.fixed=!1,this.parent=t,this.area=new ut}setArea(t,e,n,r){this.area.set(t,e,n,r)}destroy(){this.parent=null,this.area=null}}let dt,ft=0;const xt=()=>dt,pt=t=>{dt=t},mt=()=>ft,gt=t=>{ft=t};class yt{constructor(t){this.render=!0,this.update=!0,this.frame=0,this.parent=t}setRender(){this.render=!0,this.frame=mt()}setUpdate(){this.update=!0}destroy(){this.parent=null}}class Tt{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.parent=t}destroy(){this.parent=null,this.hitArea=null}}class wt{constructor(t=1,e=0,n=0,r=1,i=0,s=0){this.set(t,e,n,r,i,s)}set(t=1,e=0,n=0,r=1,i=0,s=0){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}}function St(t){const e=t.transform,n=e.local,{rotation:r,skewX:i,skewY:s,scaleX:o,scaleY:a,x:h,y:c}=e;n.set(Math.cos(r+s)*o,Math.sin(r+s)*o,-Math.sin(r-i)*a,Math.cos(r-i)*a,h,c),ct(t)}class bt{constructor(t,e=0,n=0){this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.originX=.5,this.originY=.5,this.width=0,this.height=0,this.parent=t,this.local=new wt,this.world=new wt,this.x=e,this.y=n}setSize(t,e){this.width=t,this.height=e}setWidth(t){this.width=t}setHeight(t){this.height=t}setPosition(t,e){this.x=t,this.y=e,ct(this.parent)}setX(t){this.x=t,ct(this.parent)}setY(t){this.y=t,ct(this.parent)}setOrigin(t,e){this.originX=t,this.originY=e}setOriginX(t){this.originX=t}setOriginY(t){this.originX=t}setSkew(t,e){this.skewX=t,this.skewY=e,St(this.parent)}setSkewX(t){t!==this.skewX&&(this.skewX=t,St(this.parent))}setSkewY(t){t!==this.skewY&&(this.skewY=t,St(this.parent))}setScale(t,e){this.scaleX=t,this.scaleY=e,St(this.parent)}setScaleX(t){t!==this.scaleX&&(this.scaleX=t,St(this.parent))}setScaleY(t){t!==this.scaleY&&(this.scaleY=t,St(this.parent))}setRotation(t){t!==this.rotation&&(this.rotation=t,St(this.parent))}destroy(){this.parent=null,this.local=null,this.world=null}}function vt(t,e=0,n){const r=t.children;void 0===n&&(n=r.length);const i=n-e;if(i>0&&i<=n){const t=r.splice(e,i);return t.forEach(t=>{t.parent=null}),t}return[]}function Et(t,e=0,n){vt(t,e,n).forEach(t=>{t.destroy()})}function At(t,e,n=0,r){const i=vt(t,n,r);return i.forEach(t=>{at(e,t)}),i}class Mt{constructor(t=0,e=0){this.name="",this.type="GameObject",this.willRender=!0,this.willUpdate=!0,this.visible=!0,this.children=[],this.dirty=new yt(this),this.transform=new bt(this,t,e),this.bounds=new lt(this),this.input=new Tt(this)}isRenderable(){return this.visible&&this.willRender}update(t,e){if(this.willUpdate){const n=this.children;for(let r=0;r<n.length;r++){const i=n[r];i&&i.willUpdate&&i.update(t,e)}}}get numChildren(){return this.children.length}set width(t){this.transform.setWidth(t)}get width(){return this.transform.width}set height(t){this.transform.setHeight(t)}get height(){return this.transform.height}set x(t){this.transform.setX(t)}get x(){return this.transform.x}set y(t){this.transform.setY(t)}get y(){return this.transform.y}set originX(t){this.transform.setOriginX(t)}get originX(){return this.transform.originX}set originY(t){this.transform.setOriginY(t)}get originY(){return this.transform.originY}set skewX(t){this.transform.setSkewX(t)}get skewX(){return this.transform.skewX}set skewY(t){this.transform.setSkewY(t)}get skewY(){return this.transform.skewY}set scaleX(t){this.transform.setScaleX(t)}get scaleX(){return this.transform.scaleX}set scaleY(t){this.transform.setScaleY(t)}get scaleY(){return this.transform.scaleY}set rotation(t){this.transform.setRotation(t)}get rotation(){return this.transform.rotation}destroy(t){t?At(this,t):Et(this),this.transform.destroy(),this.dirty.destroy(),this.bounds.destroy(),this.input.destroy(),this.world=null,this.parent=null,this.children=null}}class _t extends Mt{constructor(t=0,e=0){super(t,e),this._alpha=1,this.type="Container"}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t)}}function Rt(t,e,...n){const r=t.get(e);n.forEach(t=>{if(r===t.frame)return;t.frame=r,t.transform.setSize(r.sourceSizeWidth,r.sourceSizeHeight),t.bounds.setArea(t.x,t.y,t.width,t.height);const e=r.pivot;e&&t.transform.setOrigin(e.x,e.y);const n=t.vertexData;n[2]=r.u0,n[3]=r.v0,n[8]=r.u0,n[9]=r.v1,n[14]=r.u1,n[15]=r.v1,n[20]=r.u1,n[21]=r.v0,t.dirty.setRender(),t.hasTexture=!0})}let Ct;const It=()=>Ct,Pt=t=>{Ct=t};function Ft(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}function Ot(t,e,n,r=!0,i=!0){const s=It();if(!s)return;const o=s.createTexture();s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,o),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t?(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),e=t.width,n=t.height):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,n,0,s.RGBA,s.UNSIGNED_BYTE,null);const a=i?s.LINEAR:s.NEAREST;s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a);const h=t&&Ft(e,n),c=h&&r?s.REPEAT:s.CLAMP_TO_EDGE;return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,c),h&&s.generateMipmap(s.TEXTURE_2D),o}function Dt(t){const e=It();e&&e.isTexture(t)&&e.deleteTexture(t)}class zt{constructor(t,e,n,r,i,s){this.trimmed=!1,this.texture=t,this.key=e,this.x=n,this.y=r,this.width=i,this.height=s,this.sourceSizeWidth=i,this.sourceSizeHeight=s,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,n,r,i,s){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=n,this.spriteSourceSizeY=r,this.spriteSourceSizeWidth=i,this.spriteSourceSizeHeight=s}updateUVs(){const{x:t,y:e,width:n,height:r}=this,i=this.texture.width,s=this.texture.height;this.u0=t/i,this.v0=e/s,this.u1=(t+n)/i,this.v1=(e+r)/s}}class Bt{constructor(t,e,n){this.key="",this.glIndex=0,this.glIndexCounter=-1,t&&(e=t.width,n=t.height),this.image=t,this.width=e,this.height=n,this.frames=new Map,this.data={},this.add("__BASE",0,0,e,n)}add(t,e,n,r,i){if(this.frames.has(t))return null;const s=new zt(this,t,e,n,r,i);return this.frames.set(t,s),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=s),s}get(t){if(!t)return this.firstFrame;t instanceof zt&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}getFrames(t){const e=[];return t.forEach(t=>{e.push(this.get(t))}),e}getFramesInRange(t,e,n,r=0,i=""){const s=[],o=e<n?1:-1;n+=o;for(let a=e;a!==n;a+=o)s.push(t+a.toString().padStart(r,"0")+i);return this.getFrames(s)}setSize(t,e){this.width=t,this.height=e,this.frames.get("__BASE").setSize(t,e)}setFilter(t){!function(t,e=!0){const n=It();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t);const r=e?n.LINEAR:n.NEAREST;n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r)}(this.glTexture,t)}createGL(){this.glTexture&&Dt(this.glTexture),this.glTexture=Ot(this.image)}updateGL(){this.glTexture?function(t,e,n=!1){const r=It(),i=t.width,s=t.height;i>0&&s>0&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t))}(this.image,this.glTexture):this.glTexture=Ot(this.image)}destroy(){this.frames.clear(),this.image=null,this.firstFrame=null,this.data=null,Dt(this.glTexture),function(t){const e=It();e.isFramebuffer(t)&&e.deleteFramebuffer(t)}(this.glFramebuffer)}}let kt;const Lt=()=>kt,Ut=t=>{kt=t};class Gt extends _t{constructor(t,e,n,r){super(t,e),this.hasTexture=!1,this.prevTextureID=-1,this._tint=16777215,this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.type="Sprite",this.setTexture(n,r),this.bounds.setArea(t,e,this.width,this.height)}setTexture(t,e){return function(t,e,...n){if(!t)return;let r;r=t instanceof Bt?t:Lt().get(t),r?(r.glTexture||r.createGL(),n.forEach(t=>{t.texture=r,Rt(r,e,t)})):console.warn("Invalid Texture key: "+t)}(t,e,this),this}setFrame(t){return Rt(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}updateVertices(){const t=this.vertexData;this.dirty.render=!1;const e=this.frame,n=this.originX,r=this.originY;let i,s,o,a;const{a:h,b:c,c:u,d:l,tx:d,ty:f}=this.transform.world;e.trimmed?(s=e.spriteSourceSizeX-n*e.sourceSizeWidth,i=s+e.spriteSourceSizeWidth,a=e.spriteSourceSizeY-r*e.sourceSizeHeight,o=a+e.spriteSourceSizeHeight):(s=-n*e.sourceSizeWidth,i=s+e.sourceSizeWidth,a=-r*e.sourceSizeHeight,o=a+e.sourceSizeHeight);const x=s*h+a*u+d,p=s*c+a*l+f,m=s*h+o*u+d,g=s*c+o*l+f,y=i*h+o*u+d,T=i*c+o*l+f,w=i*h+a*u+d,S=i*c+a*l+f;t[0]=x,t[1]=p,t[6]=m,t[7]=g,t[12]=y,t[13]=T,t[18]=w,t[19]=S;const b=Math.min(x,m,y,w),v=Math.min(p,g,T,S),E=Math.max(x,m,y,w),A=Math.max(p,g,T,S);this.bounds.setArea(b,v,E,A)}get tint(){return this._tint}set tint(t){this._tint=t}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function Xt(t,e){const n=t.children;if(e<0||e>n.length)throw new Error("Index out of bounds: "+e);return n[e]}function Vt(){}function Nt(t,e){const{duration:n=0,repeat:r=0,delay:i=-1,onStart:s=Vt,onUpdate:o=Vt,onRepeat:a=Vt,onComplete:h=Vt}=e,c={elapsed:n,duration:n,repeat:r,delay:i,update:null,onStart:s,onUpdate:o,onRepeat:a,onComplete:h};c.update=t=>{if(c.delay>0){if(c.delay-=t,!(c.delay<0))return!1;c.delay=0}return 0===c.delay&&(c.onStart(),c.delay=-1),-1===c.delay&&(c.elapsed-=t,c.onUpdate(t,c.elapsed/c.duration),c.elapsed<=0&&(c.repeat>0?(c.repeat--,c.elapsed=c.duration,c.onRepeat(c.repeat)):(c.elapsed=0,c.onComplete()))),0===c.elapsed},t.clock.events.add(c)}function Wt(t,e,n,r){return Math.atan2(r-e,n-t)}const Yt={PI2:2*Math.PI,HALF_PI:.5*Math.PI,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function jt(t){return(t%=Yt.PI2)>=0?t:t+Yt.PI2}function Ht(t,e,n){const r=n-e;return e+((t-e)%r+r)%r}var qt=Object.freeze({__proto__:null,AngleBetween:Wt,AngleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},AngleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},AngleBetweenY:function(t,e,n,r){return Math.atan2(n-t,r-e)},CounterClockwise:function(t){return t>Math.PI&&(t-=Yt.PI2),Math.abs(((t+Yt.HALF_PI)%Yt.PI2-Yt.PI2)%Yt.PI2)},NormalizeAngle:jt,ReverseAngle:function(t){return jt(t+Math.PI)},RotateAngleTo:function(t,e,n=.05){return t===e||(Math.abs(e-t)<=n||Math.abs(e-t)>=Yt.PI2-n?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=Yt.PI2:e-=Yt.PI2),e>t?t+=n:e<t&&(t-=n))),t},ShortestAngleBetween:function(t,e){const n=e-t;return 0===n?0:n-360*Math.floor((n- -180)/360)},WrapAngle:function(t){return Ht(t,-Math.PI,Math.PI)},WrapAngleDegrees:function(t){return Ht(t,-180,180)}});function $t(t,e,n,r){const i=t-n,s=e-r;return Math.sqrt(i*i+s*s)}var Kt=Object.freeze({__proto__:null,ChebyshevDistance:function(t,e,n,r){return Math.max(Math.abs(t-n),Math.abs(e-r))},DistanceBetween:$t,DistanceBetweenPoints:function(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},DistanceBetweenPointsSquared:function(t,e){const n=t.x-e.x,r=t.y-e.y;return n*n+r*r},DistancePower:function(t,e,n,r,i=2){return Math.sqrt(Math.pow(n-t,i)+Math.pow(r-e,i))},DistanceSquared:function(t,e,n,r){const i=t-n,s=e-r;return i*i+s*s},SnakeDistance:function(t,e,n,r){return Math.abs(t-n)+Math.abs(e-r)}});function Zt(t,e){const n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}function Jt(t=32,e=32){const n=Zt(t,e);return new Bt(n.canvas)}var Qt=Object.freeze({__proto__:null,AddChild:function(t,e){return at(t,e),t.children.push(e),ct(e),e},AddChildAt:function(t,e,n){const r=t.children;return e>=0&&e<=r.length&&(at(t,n),r.splice(e,0,n),ct(n)),n},AddChildren:function(t,...e){return e.forEach(e=>{at(t,e),t.children.push(e),ct(e)}),e},AddChildrenAt:function(t,e,...n){const r=t.children;return e>=0&&e<=r.length&&n.reverse().forEach(r=>{at(t,r),n.splice(e,0,r),ct(r)}),n},AddPosition:function(t,e,...n){n.forEach(n=>{n.x+=t,n.y+=e})},AddRotation:function(t,...e){e.forEach(e=>{e.rotation+=t})},AddScale:function(t,e,...n){n.forEach(n=>{n.scaleX+=t,n.scaleY+=e})},AddSkew:function(t,e,...n){n.forEach(n=>{n.skewX+=t,n.skewY+=e})},AnimatedSprite:class extends Gt{constructor(t,e,n,r){super(t,e,n,r),this.type="AnimatedSprite",this.anims=new Map,this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const t=this.animData;t.isPlaying=!1,t.currentAnim="",t.onComplete&&t.onComplete(this,t.currentAnim)}nextFrame(){const t=this.animData;if(t.frameIndex++,t.frameIndex===t.currentFrames.length)if(t.yoyo)t.frameIndex--,t.playingForward=!1;else{if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex--,this.stop();t.frameIndex=0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}prevFrame(){const t=this.animData;if(t.frameIndex--,-1===t.frameIndex){if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex=0,this.stop();t.frameIndex=0,t.playingForward=!0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}update(t,e){super.update(t,e);const n=this.animData;n.isPlaying&&(n.nextFrameTime-=1e3*t,n.nextFrameTime=Math.max(n.nextFrameTime,0),0===n.nextFrameTime&&(n.pendingStart?(n.onStart&&n.onStart(this,n.currentAnim),n.pendingStart=!1,n.nextFrameTime=n.animSpeed):n.playingForward?this.nextFrame():this.prevFrame()))}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(t){super.destroy(t),this.anims.clear(),this.animData=null}},BringChildToTop:function(t,e){const n=t.children,r=st(t,e);return-1!==r&&r<n.length&&(n.splice(r,1),n.push(e),e.dirty.setRender()),e},Container:_t,CountMatchingChildren:function(t,e,n){const r=t.children;let i=0;return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i++}),i},DestroyChildren:Et,GameObject:Mt,GetChildAt:Xt,GetChildIndex:st,GetChildren:function(t,e,n){const r=t.children;if(!e)return[...r];const i=[];return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i.push(t)}),i},GetFirstChild:function(t,e,n){const r=t.children;for(let t=0;t<r.length;t++){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetLastChild:function(t,e,n){const r=t.children;for(let t=r.length-1;t>=0;t--){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetRandomChild:function(t,e=0,n){const r=t.children;return n||(n=r.length),r[e+Math.floor(Math.random()*n)]},MoveChildDown:function(t,e){const n=t.children,r=st(t,e);if(r>0){const t=n[r-1],i=n.indexOf(t);n[r]=t,n[i]=e,e.dirty.setRender(),t.dirty.setRender()}return e},MoveChildTo:function(t,e,n){const r=t.children,i=st(t,e);if(-1===i||n<0||n>=r.length)throw new Error("Index out of bounds");return i!==n&&(r.splice(i,1),r.splice(n,0,e),e.dirty.setRender()),e},MoveChildUp:function(t,e){const n=t.children,r=st(t,e);if(-1!==r&&r>0){const t=n[r+1],i=n.indexOf(t);n[r]=t,n[i]=e,e.dirty.setRender(),t.dirty.setRender()}return e},MoveToPosition:function(t,e,n,...r){r.forEach(r=>{const i=r.x,s=r.y,o=Wt(i,s,t,e),a=$t(i,s,t,e)/(n/1e3),h=Math.cos(o)*a,c=Math.sin(o)*a,u=t=>{t/=1e3,r.x+=h*t,r.y+=c*t},l=r.world;l&&Nt(l,{duration:n,onUpdate:u})})},RemoveChild:ot,RemoveChildAt:function(t,e){const n=t.children;let r;if(e>=0&&e<n.length){const t=n.splice(e,1);t[0]&&(r=t[0],r.parent=null)}return r},RemoveChildren:function(t,...e){e.forEach(e=>{ot(t,e)})},RemoveChildrenAt:function(t,...e){const n=t.children,r=[];return e.sort((t,e)=>t-e),e.reverse().forEach(e=>{const i=Xt(t,e);i&&(n.splice(e,1),i.parent=null,r.push(i))}),r},RemoveChildrenBetween:vt,ReparentChildren:At,RotateChildrenLeft:function(t,e=1){const n=t.children;let r=null;for(let t=0;t<e;t++)r=n.shift(),n.push(r),r.dirty.setRender();return r},RotateChildrenRight:function(t,e=1){const n=t.children;let r=null;for(let t=0;t<e;t++)r=n.pop(),n.unshift(r),r.dirty.setRender();return r},SendChildToBack:function(t,e){const n=t.children,r=st(t,e);return-1!==r&&r>0&&(n.splice(r,1),n.unshift(e),e.dirty.setRender()),e},SetBounds:function(t,e,n,r,...i){i.forEach(i=>{i.bounds.setArea(t,e,n,r)})},SetName:function(t,...e){e.forEach(e=>{e.name=t})},SetOrigin:function(t,e,...n){n.forEach(n=>{n.transform.setOrigin(t,e)})},SetParent:at,SetPosition:function(t,e,...n){n.forEach(n=>{n.transform.setPosition(t,e)})},SetRotation:function(t,...e){e.forEach(e=>{e.rotation=t})},SetScale:function(t,e,...n){n.forEach(n=>{n.transform.setScale(t,e)})},SetSize:function(t,e,...n){n.forEach(n=>{n.transform.setSize(t,e)})},SetSkew:function(t,e,...n){n.forEach(n=>{n.transform.setSkew(t,e)})},SetType:function(t,...e){e.forEach(e=>{e.type=t})},SetVisible:function(t,...e){e.forEach(e=>{e.visible=t})},SetWorld:function(t,...e){e.forEach(e=>{e.world=t})},ShuffleChildren:function(t){const e=t.children;for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r,r.dirty.setRender()}return e},Sprite:Gt,SwapChildren:function(t,e){if(t.parent===e.parent){const n=t.parent.children,r=st(t.parent,t),i=st(e.parent,e);r!==i&&(n[r]=e,n[i]=t)}},Text:class extends Gt{constructor(t,e,n="",r,i){super(t,e,Jt()),this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const s=xt();this.resolution=s.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),this.texture.glTexture=Ot(this.canvas,32,32,!1,this.antialias),r&&(this.font=r),i&&(this.fillStyle=i),this.setText(n)}syncContext(t,e){this.preRenderCallback&&this.preRenderCallback(t,e),e.font=this.font,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.lineCap="round",e.lineJoin="round",e.setLineDash(this.lineDash),e.imageSmoothingEnabled=this.antialias}updateText(){const t=this.canvas,e=this.context,n=this.resolution,r=this._text.split(this.splitRegExp),i=this.padding,s=this.fillStyle,o=this.strokeStyle,a=this.lineWidth,h=this.lineSpacing,c=a>0?a/2:0;e.clearRect(0,0,t.width,t.height),this.syncContext(t,e),e.textAlign="start";let u=0,l=0,d=0;const f=[],x="ascent"===this.verticalAlign,p=e.measureText("|MÃ‰q"),m=Math.ceil(Math.abs(p.actualBoundingBoxAscent)+Math.abs(p.actualBoundingBoxDescent))+a;for(let t=0;t<r.length;t++){const n=e.measureText(r[t]),i=n.actualBoundingBoxLeft,s=n.actualBoundingBoxRight;let o=n.actualBoundingBoxAscent,p=n.actualBoundingBoxDescent;(o||p)&&""!==r[t]||(o=m,p=0);const g=Math.ceil(Math.abs(i)+Math.abs(s))+a,y=Math.ceil(Math.abs(o)+Math.abs(p))+a;x?(d+=o+c,t>0&&(d+=h+c),l=d+p+c):(d=l+(y-p-c),l+=y,t<r.length-1&&(l+=h)),u=Math.max(u,g),f.push({lineWidth:g,lineHeight:y,ascent:o,descent:p,left:i,right:s,y:d})}u+=i.left+i.right,l+=i.top+i.bottom;const g=this.fixedWidth?this.fixedWidth:u,y=this.fixedHeight?this.fixedHeight:l,T=Math.ceil(g*n),w=Math.ceil(y*n);t.width===T&&t.height===w||(t.width=T,t.height=w,this.texture.setSize(g,y),this.transform.setSize(g,y)),e.save(),e.scale(n,n),this.syncContext(t,e);const S=this.backgroundStyle;if(S){e.save(),e.fillStyle=S,e.strokeStyle=S;const t=this.cornerRadius,n=t>0?t/2:0;t&&(e.lineWidth=t,e.strokeRect(n,n,g-t,y-t)),e.fillRect(n,n,g-t,y-t),e.restore()}const b=this.textAlign,v="center"===b,E="right"===b||"end"===b,A=(y-l)/2+i.top;for(let t=0;t<r.length;t++){const n=r[t],a=f[t];let h=i.left+a.left+c;const u=A+a.y;v?h=g/2:E&&(h=g-c),o&&e.strokeText(n,h,u),s&&e.fillText(n,h,u)}return e.restore(),this.texture.updateGL(),this.dirty.setRender(),this}get text(){return this._text}set text(t){this.setText(t)}setText(t=""){return Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}destroy(t){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(t)}}});var te=Object.freeze({__proto__:null,FuzzyCeil:function(t,e=1e-4){return Math.ceil(t-e)},FuzzyEqual:function(t,e,n=1e-4){return Math.abs(t-e)<n},FuzzyFloor:function(t,e=1e-4){return Math.floor(t+e)},FuzzyGreaterThan:function(t,e,n=1e-4){return t>e-n},FuzzyLessThan:function(t,e,n=1e-4){return t<e+n}});function ee(t){if(0===t)return 1;let e=t;for(;--t;)e*=t;return e}function ne(t,e){return ee(t)/ee(e)/ee(t-e)}function re(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function ie(t,e,n){return(e-t)*n+t}function se(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)}function oe(t,e,n){return(t=Math.max(0,Math.min(1,(t-e)/(n-e))))*t*t*(t*(6*t-15)+10)}var ae=Object.freeze({__proto__:null,BezierInterpolation:function(t,e){let n=0;const r=t.length-1;for(let i=0;i<=r;i++)n+=Math.pow(1-e,r-i)*Math.pow(e,i)*t[i]*ne(r,i);return n},CatmullRomInterpolation:function(t,e){const n=t.length-1;let r=n*e,i=Math.floor(r);return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),re(r-i,t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n])):e<0?t[0]-(re(-r,t[0],t[0],t[1],t[1])-t[0]):e>1?t[n]-(re(r-n,t[n],t[n],t[n-1],t[n-1])-t[n]):re(r-i,t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2])},CubicBezierInterpolation:function(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)},LinearInterpolation:function(t,e){const n=t.length-1,r=n*e,i=Math.floor(r);return e<0?ie(t[0],t[1],r):e>1?ie(t[n],t[n-1],n-r):ie(t[i],t[i+1>n?n:i+1],r-i)},QuadraticBezierInterpolation:function(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)},SmoothStepInterpolation:function(t,e,n){return e+(n-e)*se(t,0,1)},SmootherStepInterpolation:function(t,e,n){return e+(n-e)*oe(t,0,1)}});class he{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}}var ce=Object.freeze({__proto__:null,Add:function(t,e){return t.a+=e.a,t.b+=e.b,t.c+=e.c,t.d+=e.d,t.tx+=e.tx,t.ty+=e.ty,t},Copy:ht,CopyToContext:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;return e.transform(n,r,i,s,o,a),e},Determinant:function(t){const{a:e,b:n,c:r,d:i}=t;return e*i-n*r},Frobenius:function(t){return Math.hypot(t.a,t.b,t.c,t.d,t.tx,t.ty,1)},GlobalToLocal:function(t,e,n,r=new he){const{a:i,b:s,c:o,d:a,tx:h,ty:c}=t,u=1/(i*a+o*-s);return r.x=a*u*e+-o*u*n+(c*o-h*a)*u,r.y=i*u*n+-s*u*e+(-c*i+h*s)*u,r},Invert:function(t){const{a:e,b:n,c:r,d:i,tx:s,ty:o}=t;let a=e*i-n*r;return a&&(a=1/a,t.set(i*a,-n*a,-r*a,e*a,(r*o-i*s)*a,(n*s-e*o)*a)),t},ITRS:function(t,e,n,r,i,s){if(0===r)return t.set(1,0,0,1,e,n);{const o=Math.sin(r),a=Math.cos(r);return t.set(a*i,o*i,-o*s,a*s,e,n)}},ITRSS:function(t,e,n,r=0,i=1,s=1,o=0,a=0){return 0===r?t.set(1,0,0,1,e,n):t.set(Math.cos(r+a)*i,Math.sin(r+a)*i,-Math.sin(r-o)*s,Math.cos(r-o)*s,e,n)},LocalToGlobal:function(t,e,n,r=new he){const{a:i,b:s,c:o,d:a,tx:h,ty:c}=t;return r.x=i*e+o*n+h,r.y=s*e+a*n+c,r},Matrix2D:wt,Multiply:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t,{a:h,b:c,c:u,d:l,tx:d,ty:f}=e;return t.a=n*h+i*c,t.b=r*h+s*c,t.c=n*u+i*l,t.d=r*u+s*l,t.tx=n*d+i*f+o,t.ty=r*d+s*f+a,t},MultiplyScalar:function(t,e){return t.a*=e,t.b*=e,t.c*=e,t.d*=e,t.tx*=e,t.ty*=e,t},MultiplyScalarAndAdd:function(t,e,n){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=e;return t.a+=r*n,t.b+=i*n,t.c+=s*n,t.d+=o*n,t.tx+=a*n,t.ty+=h*n,t},Rotate:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t,h=Math.sin(e),c=Math.cos(e);return t.set(n*c+i*h,r*c+s*h,n*-h+i*c,r*-h+s*c,o,a)},Scale:function(t,e,n){return t.a*=e,t.b*=e,t.c*=n,t.d*=n,t},SetToContext:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;return e.setTransform(n,r,i,s,o,a),e},Skew:function(t,e,n){return t.b+=Math.tan(e),t.c+=Math.tan(n),t},Subtract:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=e;return t.a-=n,t.b-=r,t.c-=i,t.d-=s,t.tx-=o,t.ty-=a,t},Translate:function(t,e,n){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t;return t.tx=r*e+s*n+a,t.ty=i*e+o*n+h,t},Zero:function(t){return t.set(0,0,0,0,0,0)}});function ue(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty}function le(t,e){const{a:n,b:r,c:i,d:s}=t,o=Math.sin(e),a=Math.cos(e);return new wt(n*a+i*o,r*a+s*o,n*-o+i*a,r*-o+s*a)}function de(t,e,n){return new wt(t.a*e,t.b*e,t.c*n,t.d*n)}function fe(t,e,n){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t;return new wt(1,0,0,1,r*e+s*n+a,i*e+o*n+h)}var xe=Object.freeze({__proto__:null,Add:function(t,e){return new wt(t.a+e.a,t.b+e.b,t.c+e.c,t.c+e.c,t.tx+e.tx,t.ty+e.ty)},Append:function(t,e,n=new wt){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,{a:c,b:u,c:l,d:d,tx:f,ty:x}=e;return n.set(c*r+u*s,c*i+u*o,l*r+d*s,l*i+d*o,f*r+x*s+a,f*i+x*o+h)},Clone:function(t){return new wt(t.a,t.b,t.c,t.d,t.tx,t.ty)},Equals:function(t,e,n=1e-6){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,{a:c,b:u,c:l,d:d,tx:f,ty:x}=e;return Math.abs(r-c)<=n*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-u)<=n*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-l)<=n*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(o-d)<=n*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=n*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))},ExactEquals:ue,FromRotation:function(t){return le(new wt,t)},FromScaling:function(t,e=t){return de(new wt,t,e)},FromTranslation:function(t,e){return fe(new wt,t,e)},Identity:function(){return new wt},Invert:function(t){const{a:e,b:n,c:r,d:i,tx:s,ty:o}=t;let a=e*i-n*r;return a?(a=1/a,new wt(i*a,-n*a,-r*a,e*a,(r*o-i*s)*a,(n*s-e*o)*a)):null},Multiply:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t,{a:h,b:c,c:u,d:l,tx:d,ty:f}=e;return new wt(n*h+i*c,r*h+s*c,n*u+i*l,r*u+s*l,n*d+i*f+o,r*d+s*f+a)},MultiplyScalar:function(t,e){return new wt(t.a*e,t.b*e,t.c*e,t.d*e,t.tx*e,t.ty*e)},MultiplyScalarAndAdd:function(t,e,n){return new wt(t.a+e.a*n,t.b+e.b*n,t.c+e.c*n,t.d+e.d*n,t.tx+e.tx*n,t.ty+e.ty*n)},Rotate:le,Scale:de,Subtract:function(t,e){return new wt(t.a-e.a,t.b-e.b,t.c-e.c,t.c-e.c,t.tx-e.tx,t.ty-e.ty)},Translate:fe,Zero:function(){return new wt(0,0,0,0,0,0)}});var pe=Object.freeze({__proto__:null,GetPowerOfTwo:function(t){const e=Math.log(t)/.6931471805599453;return 1<<Math.ceil(e)},IsSizePowerOfTwo:Ft,IsValuePowerOfTwo:function(t){return t>0&&0==(t&t-1)}});var me=Object.freeze({__proto__:null,SnapCeil:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.ceil(t/e),r?(n+t)/e:n+t)},SnapFloor:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.floor(t/e),r?(n+t)/e:n+t)},SnapTo:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.round(t/e),r?(n+t)/e:n+t)}}),ge=Object.freeze({__proto__:null,Vec2:he});function ye(t,e,n){return Math.max(e,Math.min(n,t))}var Te=Object.freeze({__proto__:null,Angle:qt,Distance:Kt,Fuzzy:te,Interpolation:ae,Matrix2d:ce,Matrix2dFuncs:xe,Pow2:pe,Snap:me,Vec2:ge,Average:function(t){let e=0;for(let n=0;n<t.length;n++)e+=+t[n];return e/t.length},Bernstein:ne,Between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},CatmullRom:re,CeilTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.ceil(t*r)/r},Clamp:ye,MATH_CONST:Yt,DegToRad:function(t){return t*Yt.DEG_TO_RAD},Difference:function(t,e){return Math.abs(t-e)},Factorial:ee,FloatBetween:function(t,e){return Math.random()*(e-t)+t},FloorTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.floor(t*r)/r},FromPercent:function(t,e,n){return(n-e)*(t=ye(t,0,1))},GetSpeed:function(t,e){return t/e/1e3},Linear:ie,MaxAdd:function(t,e,n){return Math.min(t+e,n)},MinSub:function(t,e,n){return Math.max(t-e,n)},Percent:function(t,e,n,r){void 0===n&&(n=e+1);let i=(t-e)/(n-e);return i>1?void 0!==r?(i=(r-t)/(r-n),i<0&&(i=0)):i=1:i<0&&(i=0),i},RadToDeg:function(t){return t*Yt.RAD_TO_DEG},RoundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},RoundTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.round(t*r)/r},SinCosTableGenerator:function(t,e=1,n=1,r=1){r*=Math.PI/t;const i=[],s=[];for(let o=0;o<t;o++)e+=(n-=e*r)*r,i[o]=n,s[o]=e;return{sin:s,cos:i,length:t}},SmootherStep:oe,SmoothStep:se,ToXY:function(t,e,n,r=new he){let i=0,s=0;return t>0&&t<=e*n&&(t>e-1?(s=Math.floor(t/e),i=t-s*e):i=t,r.set(i,s)),r},TransformXY:function(t,e,n,r,i,s,o,a=new he){const h=Math.sin(i),c=Math.cos(i),u=c*s,l=h*s,d=-h*o,f=c*o,x=1/(u*f+d*-l);return a.x=f*x*t+-d*x*e+(r*d-n*f)*x,a.y=u*x*e+-l*x*t+(-r*u+n*l)*x,a},Within:function(t,e,n){return Math.abs(t-e)<=n},Wrap:Ht});const we=["#000","#9D9D9D","#FFF","#BE2633","#E06F8B","#493C2B","#A46422","#EB8931","#F7E26B","#2F484E","#44891A","#A3CE27","#1B2632","#005784","#31A2F2","#B2DCEF"];var Se=Object.freeze({__proto__:null,Arne16:we,C64:["#000","#fff","#8b4131","#7bbdc5","#8b41ac","#6aac41","#3931a4","#d5de73","#945a20","#5a4100","#bd736a","#525252","#838383","#acee8b","#7b73de","#acacac"],CGA:["#000","#2234d1","#0c7e45","#44aacc","#8a3622","#5c2e78","#aa5c3d","#b5b5b5","#5e606e","#4c81fb","#6cd947","#7be2f9","#eb8a60","#e23d69","#ffd93f","#fff"],JMP:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#f5f4eb"],MSX:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#fff"],PICO8:["#000","#1D2B53","#7E2553","#008751","#AB5236","#5F574F","#C2C3C7","#FFF1E8","#FF004D","#FFA300","#FFEC27","#00E436","#29ADFF","#83769C","#FF77A8","#FFCCAA"]});function be(t,e){return parseInt(t.getAttribute(e),10)}var ve=Object.freeze({__proto__:null,AtlasParser:function(t,e){let n;if(Array.isArray(e.textures)?n=e.textures[0].frames:Array.isArray(e.frames)?n=e.frames:e.hasOwnProperty("frames")?n=Object.values(e.frames):console.warn("Invalid Texture Atlas JSON"),n){let e;for(let r=0;r<n.length;r++){const i=n[r];e=t.add(i.filename,i.frame.x,i.frame.y,i.frame.w,i.frame.h),i.trimmed?e.setTrim(i.sourceSize.w,i.sourceSize.h,i.spriteSourceSize.x,i.spriteSourceSize.y,i.spriteSourceSize.w,i.spriteSourceSize.h):e.setSourceSize(i.sourceSize.w,i.sourceSize.h),i.rotated,i.anchor&&e.setPivot(i.anchor.x,i.anchor.y)}}},BitmapTextParser:function(t,e,n){const r=e.getElementsByTagName("info")[0],i=e.getElementsByTagName("common")[0],s={font:r.getAttribute("face"),size:be(r,"size"),lineHeight:be(i,"lineHeight")+0,chars:{}},o=e.getElementsByTagName("char");for(let e=0;e<o.length;e++){const n=o[e],r=be(n,"id"),i=be(n,"x"),a=be(n,"y"),h=be(n,"width"),c=be(n,"height");s.chars[r]={x:i,y:a,width:h,height:c,xOffset:be(n,"xoffset"),yOffset:be(n,"yoffset"),xAdvance:be(n,"xadvance")+0,kerning:{}},t.add(r,i,a,h,c)}const a=e.getElementsByTagName("kerning");for(let t=0;t<a.length;t++){const e=a[t],n=be(e,"first"),r=be(e,"second"),i=be(e,"amount");s.chars[r].kerning[n]=i}return s},SpriteSheetParser:function(t,e,n,r,i,s){const{frameWidth:o=null,endFrame:a=-1,margin:h=0,spacing:c=0}=s;let{frameHeight:u=null,startFrame:l=0}=s;if(u||(u=o),null===o)throw new Error("SpriteSheetParser: Invalid frameWidth");let d=Math.floor((r-h+c)/(o+c))*Math.floor((i-h+c)/(u+c));0===d&&console.warn("SpriteSheetParser: Frame config will result in zero frames"),(l>d||l<-d)&&(l=0),l<0&&(l=d+l),-1!==a&&(d=l+(a+1));let f=h,x=h,p=0,m=0;for(let s=0;s<d;s++){p=0,m=0;const a=f+o,l=x+u;a>r&&(p=a-r),l>i&&(m=l-i),t.add(s,e+f,n+x,o-p,u-m),f+=o+c,f+o>r&&(f=h,x+=u+c)}}});function Ee(t,e,n=-1,r=1){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(n-r)*2,0,-1,1,0,1])}function Ae(t,e,n,r){const i=t.texture;i.glIndexCounter<r&&e.requestTexture(i),n.count===n.batchSize&&n.flush(),function(t,e,n,r,i=!0){t.dirty.render&&t.updateVertices();const s=t.vertexData,o=t.texture.glIndex;i&&o!==t.prevTextureID&&(t.prevTextureID=o,s[4]=o,s[10]=o,s[16]=o,s[22]=o),e.set(s,r);const a=t.vertexColor;n[r+5]=a[0],n[r+11]=a[2],n[r+17]=a[3],n[r+23]=a[1]}(t,n.vertexViewF32,n.vertexViewU32,n.count*n.quadElementSize),n.count++}var Me=Object.freeze({__proto__:null,CanvasTexture:Jt,GridTexture:function(t,e,n=32,r=32,i=2,s=2){const o=Zt(n,r),a=n/i,h=r/s;o.fillStyle=t,o.fillRect(0,0,n,r),o.fillStyle=e;for(let t=0;t<s;t++)for(let e=t%2;e<i;e+=2)o.fillRect(e*a,t*h,a,h);return new Bt(o.canvas)},PixelTexture:function(t){const{data:e=[],palette:n=we,pixelWidth:r=1,pixelHeight:i=r,preRender:s=null,postRender:o=null}=t;let{canvas:a=null,resizeCanvas:h=!0,clearCanvas:c=!0}=t;const u=Math.floor(Math.abs(e[0].length*r)),l=Math.floor(Math.abs(e.length*i));a||(a=Zt(u,l).canvas,h=!1,c=!1),h&&(a.width=u,a.height=l);const d=a.getContext("2d");c&&d.clearRect(0,0,u,l),s&&s(a,d);for(let t=0;t<e.length;t++){const s=e[t];for(let e=0;e<s.length;e++){const o=s[e];"."!==o&&" "!==o&&(d.fillStyle=n[parseInt("0x"+o.toUpperCase())],d.fillRect(e*r,t*i,r,i))}}return o&&o(a,d),new Bt(a)},RenderTexture:class extends Bt{constructor(t,e=256,n=e){super(null,e,n),this.renderer=t;const[r,i]=function(t,e){const n=It(),r=Ot(null,t,e),i=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0),n.bindFramebuffer(n.FRAMEBUFFER,null),[r,i]}(e,n);this.glTexture=r,this.glFramebuffer=i,this.projectionMatrix=Ee(e,n),this.cameraMatrix=new Float32Array([1,0,0,0,0,-1,0,0,0,0,1,0,0,n,0,1])}cls(){const t=this.renderer,e=t.gl;return t.reset(this.glFramebuffer,this.width,this.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t.reset(),this}batchStart(){const t=this.renderer;return t.reset(this.glFramebuffer,this.width,this.height),t.shader.bind(this.projectionMatrix,this.cameraMatrix),this}batchDraw(t){const e=this.renderer,n=e.shader;for(let r=0,i=t.length;r<i;r++)Ae(t[r],e,n,e.startActiveTexture);return this}batchEnd(){const t=this.renderer;return t.shader.flush(),t.reset(),this}draw(...t){return this.batchStart(),this.batchDraw(t),this.batchEnd(),this}},SolidColorTexture:function(t="rgba(0,0,0,0)",e=32,n=32){const r=Zt(e,n);return r.fillStyle=t,r.fillRect(0,0,e,n),new Bt(r.canvas)}});class _e{constructor(){this.textures=new Map,this.createDefaultTextures(),Ut(this)}createDefaultTextures(){this.add("__BLANK",new Bt(Zt(32,32).canvas));const t=Zt(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new Bt(t.canvas))}get(t){const e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e){let n;const r=this.textures;return r.has(t)||(n=e instanceof Bt?e:new Bt(e),n.key=t,n.glTexture||n.createGL(),r.set(t,n)),n}}var Re=Object.freeze({__proto__:null,CreateCanvas:Zt,Frame:zt,Palettes:Se,Parsers:ve,Types:Me,Texture:Bt,TextureManager:_e});var Ce=Object.freeze({__proto__:null,AddDelayedCall:function(t,e,n){Nt(t,{duration:0,delay:e,onComplete:n})},AddTimer:Nt,Clock:class{constructor(t){this.world=t,this.timeScale=1,this.events=new Set}update(t,e){this.now=e,t*=this.timeScale,this.events.forEach(e=>{e.update(t)&&this.events.delete(e)})}},NOOP:Vt});let Ie=[];let Pe={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};const Fe=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Oe(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}const De={fragmentShader:"\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class ze{constructor(t,e={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0},this.dataSize=4,this.indexSize=4,this.vertexElementSize=6,this.vertexByteSize=24,this.quadByteSize=96,this.quadElementSize=24,this.quadIndexSize=6,this.renderer=t,this.gl=t.gl;const{batchSize:n=4096,fragmentShader:r=De.fragmentShader,vertexShader:i=De.vertexShader}=e;this.batchSize=n,this.bufferByteSize=n*this.quadByteSize,this.createBuffers(),this.createShaders(r,i),this.count=0}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const n=this.gl,r=this.renderer.maxTextures;let i="";if(r>1){for(let t=0;t<r;t++)t>0&&(i+="\nelse "),t<r-1&&(i+=`if (vTextureId < ${t}.5)`),i+="\n{",i+=`\n  color = texture2D(uTexture[${t}], vTextureCoord);`,i+="\n}";t=(t=t.replace(/%count%/gi,""+r)).replace(/%forloop%/gi,i)}else i="color = texture2D(uTexture[0], vTextureCoord);";const s=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,t),n.compileShader(s);const o=n.createShader(n.VERTEX_SHADER);n.shaderSource(o,e),n.compileShader(o);const a=n.createProgram();n.attachShader(a,o),n.attachShader(a,s),n.linkProgram(a),n.useProgram(a),this.program=a;for(const t of Object.keys(this.attribs)){const e=n.getAttribLocation(a,t);n.enableVertexAttribArray(e),this.attribs[t]=e}for(const t of Object.keys(this.uniforms))this.uniforms[t]=n.getUniformLocation(a,t)}bind(t,e){const n=this.gl,r=this.renderer,i=this.uniforms;n.useProgram(this.program),n.uniformMatrix4fv(i.uProjectionMatrix,!1,t),n.uniformMatrix4fv(i.uCameraMatrix,!1,e),n.uniform1iv(i.uTexture,r.textureIndex),this.bindBuffers(this.indexBuffer,this.vertexBuffer)}bindBuffers(t,e){const n=this.gl,r=this.vertexByteSize,i=this.attribs;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.bindBuffer(n.ARRAY_BUFFER,e),n.vertexAttribPointer(i.aVertexPosition,2,n.FLOAT,!1,r,0),n.vertexAttribPointer(i.aTextureCoord,2,n.FLOAT,!1,r,8),n.vertexAttribPointer(i.aTextureId,1,n.FLOAT,!1,r,16),n.vertexAttribPointer(i.aTintColor,4,n.UNSIGNED_BYTE,!0,r,20),this.count=0}draw(t){const e=this.gl,n=t*this.quadByteSize;if(n===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{const t=this.vertexViewF32.subarray(0,n);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0)}flush(){const t=this.count;return 0!==t&&(this.draw(t),this.prevCount=t,this.count=0,this.renderer.flushTotal++,!0)}}let Be;const ke=()=>Be,Le=t=>{Be=t};class Ue{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult={gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]},this.game=xt(),Le(this),rt(this.game,"boot",()=>this.boot())}boot(){Ie.forEach(t=>new t)}update(t,e){for(const n of this.scenes.values())Q(n,"update",t,e)}render(t){const e=this.renderResult;!function(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}(e,t);for(const t of this.scenes.values())Q(t,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}}function Ge(t,e={}){const n=ke(),r=n.scenes.size,i=n.sceneIndex,s=0===r;"string"==typeof e?t.key=e:(e||!e&&s)&&(t.key=function(t,e,n){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:n}(e,"key","scene"+i)),n.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(n.scenes.set(t.key,t),n.flush=!0,n.sceneIndex++)}t.DOM=r,t.Device=J,t.Events=it,t.Game=class extends tt{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.frame=0,pt(this),n(()=>this.boot(t))}boot(t){t.forEach(t=>t());const e=void 0;this.renderer=new e,this.textureManager=new _e,this.sceneManager=new Ue,this.isBooted=!0,function(){{const t=" v"+xt().VERSION;console.log(`%cPhaser${t}%c https://phaser4.io`,"padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}}(),Q(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){const e=t-this.lastTick;this.lastTick=t,this.isPaused||(this.willUpdate&&this.sceneManager.update(e,t),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,gt(this.frame),requestAnimationFrame(t=>this.step(t))}destroy(){}},t.GameObjects=Qt,t.Loader=class extends tt{constructor(){super(),this.baseURL="",this.path="",this.crossOrigin="anonymous",this.maxParallelDownloads=-1,this.isLoading=!1,this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...t){return t.forEach(t=>{t.loader=this,this.queue.add(t)}),this}start(t){return this.isLoading||(this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=t,Q(this,"start"),this.nextFile()):(this.progress=1,Q(this,"complete"),t())),this}nextFile(){let t=this.queue.size;if(-1!==this.maxParallelDownloads&&(t=Math.min(t,this.maxParallelDownloads)-this.inflight.size),t){const e=this.queue.values();for(;t>0;){const n=e.next().value;this.inflight.add(n),this.queue.delete(n),n.load().then(t=>this.fileComplete(t)).catch(t=>this.fileError(t)),t--}}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading=!1,Q(this,"complete",this.completed),this.onComplete(),this.completed.clear()}updateProgress(t){this.inflight.delete(t),this.completed.add(t);const e=this.completed.size,n=this.queue.size+this.inflight.size;e>0&&(this.progress=e/(e+n)),Q(this,"progress",this.progress,e,n),this.nextFile()}fileComplete(t){Q(this,"filecomplete",t),this.updateProgress(t)}fileError(t){Q(this,"fileerror",t),this.updateProgress(t)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}setMaxParallelDownloads(t){return this.maxParallelDownloads=t,this}},t.Math=Te,t.Scene=class{constructor(t){this.game=xt(),this.events=new Map,Ge(this,t)}},t.Textures=Re,t.Time=Ce,t.WebGLRenderer=class{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.clearBeforeRender=!0,this.optimizeRedraw=!0,this.autoResize=!0,this.contextLost=!1,this.width=800,this.height=600,this.resolution=1,this.setBackgroundColor(0);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.initContext(),this.shader=new ze(this)}initContext(){const t=this.canvas.getContext("webgl",Pe);Pt(t),this.gl=t,this.elementIndexExtension=t.getExtension("OES_element_index_uint"),this.getMaxTextures(),this.shader&&(this.shader.gl=t),t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),this.resize(this.width,this.height,this.resolution)}resize(t,e,n=1){this.width=t*n,this.height=e*n,this.resolution=n;const r=this.canvas;r.width=this.width,r.height=this.height,this.autoResize&&(r.style.width=this.width/n+"px",r.style.height=this.height/n+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Ee(t,e)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){const e=this.clearColor,n=t>>16&255,r=t>>8&255,i=255&t,s=t>16777215?t>>>24:255;return e[0]=n/255,e[1]=r/255,e[2]=i/255,e[3]=s/255,this}getMaxTextures(){const t=this.gl,e=function(t,e){const n=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=Fe.replace(/%forloop%/gi,Oe(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t),n=this.tempTextures;n.length&&n.forEach(e=>{t.deleteTexture(e)});for(let r=0;r<e;r++){const e=t.createTexture();t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),n[r]=e}this.maxTextures=e,this.textureIndex=Array.from(Array(e).keys()),this.activeTextures=Array(e),this.currentActiveTexture=0}reset(t=null,e=this.width,n=this.height){const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),r.viewport(0,0,e,n),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),this.currentActiveTexture=0,this.startActiveTexture++,this.flushTotal=0}render(t){if(this.contextLost)return;const e=this.gl;if(this.reset(),this.optimizeRedraw&&0===t.numDirtyFrames&&0===t.numDirtyCameras)return;const n=this.shader,r=this.clearColor;this.clearBeforeRender&&(e.clearColor(r[0],r[1],r[2],r[3]),e.clear(e.COLOR_BUFFER_BIT));const i=this.projectionMatrix;let s;const o=t.worldData;for(let t=0;t<o.length;t++){const{camera:e,renderList:r,numRendered:a}=o[t];s&&ue(e.worldTransform,s.worldTransform)||(n.flush(),n.bind(i,e.matrix),s=e);for(let t=0;t<a;t++)Ae(r[t],this,n,this.startActiveTexture)}n.flush()}resetTextures(t){const e=this.gl,n=this.activeTextures;n.fill(null),this.currentActiveTexture=0,this.startActiveTexture++,t&&(n[0]=t,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture=1)}requestTexture(t){const e=this.gl;t.glIndexCounter=this.startActiveTexture,this.currentActiveTexture<this.maxTextures?(this.activeTextures[this.currentActiveTexture]=t,t.glIndex=this.currentActiveTexture,e.activeTexture(e.TEXTURE0+this.currentActiveTexture),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture++):(this.shader.flush(),this.resetTextures(t))}}}));
